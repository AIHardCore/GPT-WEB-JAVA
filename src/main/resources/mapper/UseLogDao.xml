<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cn.app.chatgptbot.dao.UseLogDao">


    <select id="getDayUseNumber" resultType="java.lang.Integer">
        SELECT count( 1 ) FROM use_log WHERE  state = 0 and date_format(create_time,'%Y-%m-%d') >= curdate() AND user_id = #{userId}
    </select>

    <select id="findLogByConversationId" resultType="com.cn.app.chatgptbot.model.UseLog">
        SELECT
            a.id,
            a.conversation_id,
            a.question,
            a.answer
        FROM
            use_log a,
            ( SELECT max( id ) AS mid, user_id, max( create_time ) create_time FROM use_log WHERE user_id = #{userId} GROUP BY conversation_id ) b
        WHERE
            a.id = b.mid
    </select>
</mapper>
